@@ -1,6 +1,33 @@
**/*.class
**/*.jar
**/*.war
**/*.ear
**/*.metadata
target/
HELP.md
target/
!.mvn/wrapper/maven-wrapper.jar
!**/src/main/**/target/
!**/src/test/**/target/

### STS ###
.apt_generated
.classpath
.factorypath
.project
.settings
.springBeans
.sts4-cache

### IntelliJ IDEA ###
.idea
*.iws
*.iml
*.ipr

### NetBeans ###
/nbproject/private/
/nbbuild/
/dist/
/nbdist/
/.nb-gradle/
build/
!**/src/main/**/build/
!**/src/test/**/build/

### VS Code ###
.vscode/
 Binary file addedBIN +61.1 KB 
.mvn/wrapper/maven-wrapper.jar
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
Binary file not shown.
 2 changes: 2 additions & 0 deletions2  
.mvn/wrapper/maven-wrapper.properties
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,2 @@
distributionUrl=https://repo.maven.apache.org/maven2/org/apache/maven/apache-maven/3.9.5/apache-maven-3.9.5-bin.zip
wrapperUrl=https://repo.maven.apache.org/maven2/org/apache/maven/wrapper/maven-wrapper/3.2.0/maven-wrapper-3.2.0.jar
 39 changes: 39 additions & 0 deletions39  
Build.yml
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,39 @@
#Build Tools
BuildTool: MAVEN
JavaVersion: Java 17
VersionFilePath: ''

#SignCode: 
SignCode:
  ApplicationName: APP00236616_Prod
  Label: APP00236616_Prod 

#Compile Test
CompileScripts:
  - mvn clean compile -f pom.xml -Djarsigner.skip=true

#Build 
BuildScripts:
    - mvn clean deploy -f pom.xml -Djarsigner.skip=false -X
    - mvn sonar:sonar -f pom.xml

  #UCD
PushToUCD: true
ApplicationName: Claims_Service

#Artifacts
Artifacts:
    #Artifact
    - Artifact:
        Component: Env-Uplift-Services
        GroupID: com.hcsc.envUplift
        ArtifactID: Env-uplift-api
        VersionID: pom.xml
        PackagingID: jar
        ClassifierID: ''

#AutoDeploy to Dev
DeployUCD:
  AutoDeploy: true
  DevEnvironment: UIT1
  DeployProcess: Env-Uplift-Services Deployment
 40 changes: 40 additions & 0 deletions40  
manifest-azr-sit1.yml
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,40 @@
---
applications:
- name: Env-Uplift-Services
  memory: 1G
  instances: 1
  disk_quota: 512M
  buildpacks:
    - conjur_buildpack
    - java_buildpack_offline
  #path: idr.jar

  routes:
   - route: envuplift-api-sit1.cfaa.azr.hcsctest.net
   - route: envuplift-api-sit1.test.fyiblue.com
   - route: envuplift-ui-sit1.test.fyiblue.com/envUplift-api
   - route: envuplift-api-sit1.test.hcscint.net
  services:
    - ccdm_conjur_service

  path: target/Env-Uplift-Services.jar
  #host: idr-dev
  env:
    SECRETS_YAML_PATH: secrets.yml
    SECRETS_YAML_ENVIRONMENT: Nonprod
    APP_LOG_LEVEL: INFO
    SPRING_PROFILES_ACTIVE: 'sit1,dev'
    APPLICATION_ID: APP00236616
#    AUTH_URI: ssoAuth
    BASE_UI_URI: .
 #   DISPUTE_UTIL_URI: disputeUtil
#    DISPUTE_CASE_URI: disputeEligibility
#    ELIGIBILITY_URI: disputeEligibility
#    DISP_SUBMISSION_URI: disputeSubmission
#    BLUE_SQUARED_UTIL_URI: blueSquaredUtil
#    DISPUTE_PROCESS_URI: disputeProcess
#    BATCH_UTIL_URI: batchUtilService

    ENVIRONMENT: sit1
    DT_TAGS: APPID=APP00236616 Portfolio=Claims AYS=No_Alerts
    JBP_CONFIG_OPEN_JDK_JRE: '{ "jre": { version: 17.+} }'
 40 changes: 40 additions & 0 deletions40  
manifest-azr-uat1.yml
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,40 @@
---
applications:
- name: Env-Uplift-Services
  memory: 1G
  instances: 1
  disk_quota: 512M
  buildpacks:
    - conjur_buildpack
    - java_buildpack_offline
  #path: idr.jar

  routes:
   - route: envuplift-api-uat1.cfaa.azr.hcsctest.net
   - route: envuplift-api-uat1.test.fyiblue.com
   - route: envuplift-ui-uat1.test.fyiblue.com/envUplift-api
   - route: envuplift-api-uat1.test.hcscint.net
  services:
    - ccdm_conjur_service

  path: target/Env-Uplift-Services.jar
  #host: idr-dev
  env:
    SECRETS_YAML_PATH: secrets.yml
    SECRETS_YAML_ENVIRONMENT: Nonprod
    APP_LOG_LEVEL: INFO
    SPRING_PROFILES_ACTIVE: 'uat1,dev'
    APPLICATION_ID: APP00236616
#    AUTH_URI: ssoAuth
    BASE_UI_URI: .
 #   DISPUTE_UTIL_URI: disputeUtil
#    DISPUTE_CASE_URI: disputeEligibility
#    ELIGIBILITY_URI: disputeEligibility
#    DISP_SUBMISSION_URI: disputeSubmission
#    BLUE_SQUARED_UTIL_URI: blueSquaredUtil
#    DISPUTE_PROCESS_URI: disputeProcess
#    BATCH_UTIL_URI: batchUtilService

    ENVIRONMENT: uat1
    DT_TAGS: APPID=APP00236616 Portfolio=Claims AYS=No_Alerts
    JBP_CONFIG_OPEN_JDK_JRE: '{ "jre": { version: 17.+} }'
 40 changes: 40 additions & 0 deletions40  
manifest-azr-uit1.yml
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,40 @@
---
applications:
- name: Env-Uplift-Services
  memory: 1G
  instances: 1
  disk_quota: 512M
  buildpacks:
    - conjur_buildpack
    - java_buildpack_offline
  #path: idr.jar

  routes:
   - route: envuplift-api-uit1.cfaa.azr.hcsctest.net
   - route: envuplift-api-uit1.test.fyiblue.com
   - route: envuplift-ui-uit1.test.fyiblue.com/envUplift-api
   - route: envuplift-api-uit1.test.hcscint.net
  services:
    - ccdm_conjur_service

  path: target/Env-Uplift-Services.jar
  #host: idr-dev
  env:
    SECRETS_YAML_PATH: secrets.yml
    SECRETS_YAML_ENVIRONMENT: Nonprod
    APP_LOG_LEVEL: INFO
    SPRING_PROFILES_ACTIVE: 'uit1,dev'
    APPLICATION_ID: APP00236616
#    AUTH_URI: ssoAuth
    BASE_UI_URI: .
 #   DISPUTE_UTIL_URI: disputeUtil
#    DISPUTE_CASE_URI: disputeEligibility
#    ELIGIBILITY_URI: disputeEligibility
#    DISP_SUBMISSION_URI: disputeSubmission
#    BLUE_SQUARED_UTIL_URI: blueSquaredUtil
#    DISPUTE_PROCESS_URI: disputeProcess
#    BATCH_UTIL_URI: batchUtilService

    ENVIRONMENT: uit1
    DT_TAGS: APPID=APP00236616 Portfolio=Claims AYS=No_Alerts
    JBP_CONFIG_OPEN_JDK_JRE: '{ "jre": { version: 17.+} }'
 308 changes: 308 additions & 0 deletions308  
mvnw
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,308 @@
#!/bin/sh
# ----------------------------------------------------------------------------
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#    https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------
# Apache Maven Wrapper startup batch script, version 3.2.0
#
# Required ENV vars:
# ------------------
#   JAVA_HOME - location of a JDK home dir
#
# Optional ENV vars
# -----------------
#   MAVEN_OPTS - parameters passed to the Java VM when running Maven
#     e.g. to debug Maven itself, use
#       set MAVEN_OPTS=-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8000
#   MAVEN_SKIP_RC - flag to disable loading of mavenrc files
# ----------------------------------------------------------------------------

if [ -z "$MAVEN_SKIP_RC" ] ; then

  if [ -f /usr/local/etc/mavenrc ] ; then
    . /usr/local/etc/mavenrc
  fi

  if [ -f /etc/mavenrc ] ; then
    . /etc/mavenrc
  fi

  if [ -f "$HOME/.mavenrc" ] ; then
    . "$HOME/.mavenrc"
  fi

fi

# OS specific support.  $var _must_ be set to either true or false.
cygwin=false;
darwin=false;
mingw=false
case "$(uname)" in
  CYGWIN*) cygwin=true ;;
  MINGW*) mingw=true;;
  Darwin*) darwin=true
    # Use /usr/libexec/java_home if available, otherwise fall back to /Library/Java/Home
    # See https://developer.apple.com/library/mac/qa/qa1170/_index.html
    if [ -z "$JAVA_HOME" ]; then
      if [ -x "/usr/libexec/java_home" ]; then
        JAVA_HOME="$(/usr/libexec/java_home)"; export JAVA_HOME
      else
        JAVA_HOME="/Library/Java/Home"; export JAVA_HOME
      fi
    fi
    ;;
esac

if [ -z "$JAVA_HOME" ] ; then
  if [ -r /etc/gentoo-release ] ; then
    JAVA_HOME=$(java-config --jre-home)
  fi
fi

# For Cygwin, ensure paths are in UNIX format before anything is touched
if $cygwin ; then
  [ -n "$JAVA_HOME" ] &&
    JAVA_HOME=$(cygpath --unix "$JAVA_HOME")
  [ -n "$CLASSPATH" ] &&
    CLASSPATH=$(cygpath --path --unix "$CLASSPATH")
fi

# For Mingw, ensure paths are in UNIX format before anything is touched
if $mingw ; then
  [ -n "$JAVA_HOME" ] && [ -d "$JAVA_HOME" ] &&
    JAVA_HOME="$(cd "$JAVA_HOME" || (echo "cannot cd into $JAVA_HOME."; exit 1); pwd)"
fi

if [ -z "$JAVA_HOME" ]; then
  javaExecutable="$(which javac)"
  if [ -n "$javaExecutable" ] && ! [ "$(expr "\"$javaExecutable\"" : '\([^ ]*\)')" = "no" ]; then
    # readlink(1) is not available as standard on Solaris 10.
    readLink=$(which readlink)
    if [ ! "$(expr "$readLink" : '\([^ ]*\)')" = "no" ]; then
      if $darwin ; then
        javaHome="$(dirname "\"$javaExecutable\"")"
        javaExecutable="$(cd "\"$javaHome\"" && pwd -P)/javac"
      else
        javaExecutable="$(readlink -f "\"$javaExecutable\"")"
      fi
      javaHome="$(dirname "\"$javaExecutable\"")"
      javaHome=$(expr "$javaHome" : '\(.*\)/bin')
      JAVA_HOME="$javaHome"
      export JAVA_HOME
    fi
  fi
fi

if [ -z "$JAVACMD" ] ; then
  if [ -n "$JAVA_HOME"  ] ; then
    if [ -x "$JAVA_HOME/jre/sh/java" ] ; then
      # IBM's JDK on AIX uses strange locations for the executables
      JAVACMD="$JAVA_HOME/jre/sh/java"
    else
      JAVACMD="$JAVA_HOME/bin/java"
    fi
  else
    JAVACMD="$(\unset -f command 2>/dev/null; \command -v java)"
  fi
fi

if [ ! -x "$JAVACMD" ] ; then
  echo "Error: JAVA_HOME is not defined correctly." >&2
  echo "  We cannot execute $JAVACMD" >&2
  exit 1
fi

if [ -z "$JAVA_HOME" ] ; then
  echo "Warning: JAVA_HOME environment variable is not set."
fi

# traverses directory structure from process work directory to filesystem root
# first directory with .mvn subdirectory is considered project base directory
find_maven_basedir() {
  if [ -z "$1" ]
  then
    echo "Path not specified to find_maven_basedir"
    return 1
  fi

  basedir="$1"
  wdir="$1"
  while [ "$wdir" != '/' ] ; do
    if [ -d "$wdir"/.mvn ] ; then
      basedir=$wdir
      break
    fi
    # workaround for JBEAP-8937 (on Solaris 10/Sparc)
    if [ -d "${wdir}" ]; then
      wdir=$(cd "$wdir/.." || exit 1; pwd)
    fi
    # end of workaround
  done
  printf '%s' "$(cd "$basedir" || exit 1; pwd)"
}

# concatenates all lines of a file
concat_lines() {
  if [ -f "$1" ]; then
    # Remove \r in case we run on Windows within Git Bash
    # and check out the repository with auto CRLF management
    # enabled. Otherwise, we may read lines that are delimited with
    # \r\n and produce $'-Xarg\r' rather than -Xarg due to word
    # splitting rules.
    tr -s '\r\n' ' ' < "$1"
  fi
}

log() {
  if [ "$MVNW_VERBOSE" = true ]; then
    printf '%s\n' "$1"
  fi
}

BASE_DIR=$(find_maven_basedir "$(dirname "$0")")
if [ -z "$BASE_DIR" ]; then
  exit 1;
fi

MAVEN_PROJECTBASEDIR=${MAVEN_BASEDIR:-"$BASE_DIR"}; export MAVEN_PROJECTBASEDIR
log "$MAVEN_PROJECTBASEDIR"

##########################################################################################
# Extension to allow automatically downloading the maven-wrapper.jar from Maven-central
# This allows using the maven wrapper in projects that prohibit checking in binary data.
##########################################################################################
wrapperJarPath="$MAVEN_PROJECTBASEDIR/.mvn/wrapper/maven-wrapper.jar"
if [ -r "$wrapperJarPath" ]; then
    log "Found $wrapperJarPath"
else
    log "Couldn't find $wrapperJarPath, downloading it ..."

    if [ -n "$MVNW_REPOURL" ]; then
      wrapperUrl="$MVNW_REPOURL/org/apache/maven/wrapper/maven-wrapper/3.2.0/maven-wrapper-3.2.0.jar"
    else
      wrapperUrl="https://repo.maven.apache.org/maven2/org/apache/maven/wrapper/maven-wrapper/3.2.0/maven-wrapper-3.2.0.jar"
    fi
    while IFS="=" read -r key value; do
      # Remove '\r' from value to allow usage on windows as IFS does not consider '\r' as a separator ( considers space, tab, new line ('\n'), and custom '=' )
      safeValue=$(echo "$value" | tr -d '\r')
      case "$key" in (wrapperUrl) wrapperUrl="$safeValue"; break ;;
      esac
    done < "$MAVEN_PROJECTBASEDIR/.mvn/wrapper/maven-wrapper.properties"
    log "Downloading from: $wrapperUrl"

    if $cygwin; then
      wrapperJarPath=$(cygpath --path --windows "$wrapperJarPath")
    fi

    if command -v wget > /dev/null; then
        log "Found wget ... using wget"
        [ "$MVNW_VERBOSE" = true ] && QUIET="" || QUIET="--quiet"
        if [ -z "$MVNW_USERNAME" ] || [ -z "$MVNW_PASSWORD" ]; then
            wget $QUIET "$wrapperUrl" -O "$wrapperJarPath" || rm -f "$wrapperJarPath"
        else
            wget $QUIET --http-user="$MVNW_USERNAME" --http-password="$MVNW_PASSWORD" "$wrapperUrl" -O "$wrapperJarPath" || rm -f "$wrapperJarPath"
        fi
    elif command -v curl > /dev/null; then
        log "Found curl ... using curl"
        [ "$MVNW_VERBOSE" = true ] && QUIET="" || QUIET="--silent"
        if [ -z "$MVNW_USERNAME" ] || [ -z "$MVNW_PASSWORD" ]; then
            curl $QUIET -o "$wrapperJarPath" "$wrapperUrl" -f -L || rm -f "$wrapperJarPath"
        else
            curl $QUIET --user "$MVNW_USERNAME:$MVNW_PASSWORD" -o "$wrapperJarPath" "$wrapperUrl" -f -L || rm -f "$wrapperJarPath"
        fi
    else
        log "Falling back to using Java to download"
        javaSource="$MAVEN_PROJECTBASEDIR/.mvn/wrapper/MavenWrapperDownloader.java"
        javaClass="$MAVEN_PROJECTBASEDIR/.mvn/wrapper/MavenWrapperDownloader.class"
        # For Cygwin, switch paths to Windows format before running javac
        if $cygwin; then
          javaSource=$(cygpath --path --windows "$javaSource")
          javaClass=$(cygpath --path --windows "$javaClass")
        fi
        if [ -e "$javaSource" ]; then
            if [ ! -e "$javaClass" ]; then
                log " - Compiling MavenWrapperDownloader.java ..."
                ("$JAVA_HOME/bin/javac" "$javaSource")
            fi
            if [ -e "$javaClass" ]; then
                log " - Running MavenWrapperDownloader.java ..."
                ("$JAVA_HOME/bin/java" -cp .mvn/wrapper MavenWrapperDownloader "$wrapperUrl" "$wrapperJarPath") || rm -f "$wrapperJarPath"
            fi
        fi
    fi
fi
##########################################################################################
# End of extension
##########################################################################################

# If specified, validate the SHA-256 sum of the Maven wrapper jar file
wrapperSha256Sum=""
while IFS="=" read -r key value; do
  case "$key" in (wrapperSha256Sum) wrapperSha256Sum=$value; break ;;
  esac
done < "$MAVEN_PROJECTBASEDIR/.mvn/wrapper/maven-wrapper.properties"
if [ -n "$wrapperSha256Sum" ]; then
  wrapperSha256Result=false
  if command -v sha256sum > /dev/null; then
    if echo "$wrapperSha256Sum  $wrapperJarPath" | sha256sum -c > /dev/null 2>&1; then
      wrapperSha256Result=true
    fi
  elif command -v shasum > /dev/null; then
    if echo "$wrapperSha256Sum  $wrapperJarPath" | shasum -a 256 -c > /dev/null 2>&1; then
      wrapperSha256Result=true
    fi
  else
    echo "Checksum validation was requested but neither 'sha256sum' or 'shasum' are available."
    echo "Please install either command, or disable validation by removing 'wrapperSha256Sum' from your maven-wrapper.properties."
    exit 1
  fi
  if [ $wrapperSha256Result = false ]; then
    echo "Error: Failed to validate Maven wrapper SHA-256, your Maven wrapper might be compromised." >&2
    echo "Investigate or delete $wrapperJarPath to attempt a clean download." >&2
    echo "If you updated your Maven version, you need to update the specified wrapperSha256Sum property." >&2
    exit 1
  fi
fi

MAVEN_OPTS="$(concat_lines "$MAVEN_PROJECTBASEDIR/.mvn/jvm.config") $MAVEN_OPTS"

# For Cygwin, switch paths to Windows format before running java
if $cygwin; then
  [ -n "$JAVA_HOME" ] &&
    JAVA_HOME=$(cygpath --path --windows "$JAVA_HOME")
  [ -n "$CLASSPATH" ] &&
    CLASSPATH=$(cygpath --path --windows "$CLASSPATH")
  [ -n "$MAVEN_PROJECTBASEDIR" ] &&
    MAVEN_PROJECTBASEDIR=$(cygpath --path --windows "$MAVEN_PROJECTBASEDIR")
fi

# Provide a "standardized" way to retrieve the CLI args that will
# work with both Windows and non-Windows executions.
MAVEN_CMD_LINE_ARGS="$MAVEN_CONFIG $*"
export MAVEN_CMD_LINE_ARGS

WRAPPER_LAUNCHER=org.apache.maven.wrapper.MavenWrapperMain

# shellcheck disable=SC2086 # safe args
exec "$JAVACMD" \
  $MAVEN_OPTS \
  $MAVEN_DEBUG_OPTS \
  -classpath "$MAVEN_PROJECTBASEDIR/.mvn/wrapper/maven-wrapper.jar" \
  "-Dmaven.multiModuleProjectDirectory=${MAVEN_PROJECTBASEDIR}" \
  ${WRAPPER_LAUNCHER} $MAVEN_CONFIG "$@"
 205 changes: 205 additions & 0 deletions205  
mvnw.cmd
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,205 @@
@REM ----------------------------------------------------------------------------
@REM Licensed to the Apache Software Foundation (ASF) under one
@REM or more contributor license agreements.  See the NOTICE file
@REM distributed with this work for additional information
@REM regarding copyright ownership.  The ASF licenses this file
@REM to you under the Apache License, Version 2.0 (the
@REM "License"); you may not use this file except in compliance
@REM with the License.  You may obtain a copy of the License at
@REM
@REM    https://www.apache.org/licenses/LICENSE-2.0
@REM
@REM Unless required by applicable law or agreed to in writing,
@REM software distributed under the License is distributed on an
@REM "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
@REM KIND, either express or implied.  See the License for the
@REM specific language governing permissions and limitations
@REM under the License.
@REM ----------------------------------------------------------------------------

@REM ----------------------------------------------------------------------------
@REM Apache Maven Wrapper startup batch script, version 3.2.0
@REM
@REM Required ENV vars:
@REM JAVA_HOME - location of a JDK home dir
@REM
@REM Optional ENV vars
@REM MAVEN_BATCH_ECHO - set to 'on' to enable the echoing of the batch commands
@REM MAVEN_BATCH_PAUSE - set to 'on' to wait for a keystroke before ending
@REM MAVEN_OPTS - parameters passed to the Java VM when running Maven
@REM     e.g. to debug Maven itself, use
@REM set MAVEN_OPTS=-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8000
@REM MAVEN_SKIP_RC - flag to disable loading of mavenrc files
@REM ----------------------------------------------------------------------------

@REM Begin all REM lines with '@' in case MAVEN_BATCH_ECHO is 'on'
@echo off
@REM set title of command window
title %0
@REM enable echoing by setting MAVEN_BATCH_ECHO to 'on'
@if "%MAVEN_BATCH_ECHO%" == "on"  echo %MAVEN_BATCH_ECHO%

@REM set %HOME% to equivalent of $HOME
if "%HOME%" == "" (set "HOME=%HOMEDRIVE%%HOMEPATH%")

@REM Execute a user defined script before this one
if not "%MAVEN_SKIP_RC%" == "" goto skipRcPre
@REM check for pre script, once with legacy .bat ending and once with .cmd ending
if exist "%USERPROFILE%\mavenrc_pre.bat" call "%USERPROFILE%\mavenrc_pre.bat" %*
if exist "%USERPROFILE%\mavenrc_pre.cmd" call "%USERPROFILE%\mavenrc_pre.cmd" %*
:skipRcPre

@setlocal

set ERROR_CODE=0

@REM To isolate internal variables from possible post scripts, we use another setlocal
@setlocal

@REM ==== START VALIDATION ====
if not "%JAVA_HOME%" == "" goto OkJHome

echo.
echo Error: JAVA_HOME not found in your environment. >&2
echo Please set the JAVA_HOME variable in your environment to match the >&2
echo location of your Java installation. >&2
echo.
goto error

:OkJHome
if exist "%JAVA_HOME%\bin\java.exe" goto init

echo.
echo Error: JAVA_HOME is set to an invalid directory. >&2
echo JAVA_HOME = "%JAVA_HOME%" >&2
echo Please set the JAVA_HOME variable in your environment to match the >&2
echo location of your Java installation. >&2
echo.
goto error

@REM ==== END VALIDATION ====

:init

@REM Find the project base dir, i.e. the directory that contains the folder ".mvn".
@REM Fallback to current working directory if not found.

set MAVEN_PROJECTBASEDIR=%MAVEN_BASEDIR%
IF NOT "%MAVEN_PROJECTBASEDIR%"=="" goto endDetectBaseDir

set EXEC_DIR=%CD%
set WDIR=%EXEC_DIR%
:findBaseDir
IF EXIST "%WDIR%"\.mvn goto baseDirFound
cd ..
IF "%WDIR%"=="%CD%" goto baseDirNotFound
set WDIR=%CD%
goto findBaseDir

:baseDirFound
set MAVEN_PROJECTBASEDIR=%WDIR%
cd "%EXEC_DIR%"
goto endDetectBaseDir

:baseDirNotFound
set MAVEN_PROJECTBASEDIR=%EXEC_DIR%
cd "%EXEC_DIR%"

:endDetectBaseDir

IF NOT EXIST "%MAVEN_PROJECTBASEDIR%\.mvn\jvm.config" goto endReadAdditionalConfig

@setlocal EnableExtensions EnableDelayedExpansion
for /F "usebackq delims=" %%a in ("%MAVEN_PROJECTBASEDIR%\.mvn\jvm.config") do set JVM_CONFIG_MAVEN_PROPS=!JVM_CONFIG_MAVEN_PROPS! %%a
@endlocal & set JVM_CONFIG_MAVEN_PROPS=%JVM_CONFIG_MAVEN_PROPS%

:endReadAdditionalConfig

SET MAVEN_JAVA_EXE="%JAVA_HOME%\bin\java.exe"
set WRAPPER_JAR="%MAVEN_PROJECTBASEDIR%\.mvn\wrapper\maven-wrapper.jar"
set WRAPPER_LAUNCHER=org.apache.maven.wrapper.MavenWrapperMain

set WRAPPER_URL="https://repo.maven.apache.org/maven2/org/apache/maven/wrapper/maven-wrapper/3.2.0/maven-wrapper-3.2.0.jar"

FOR /F "usebackq tokens=1,2 delims==" %%A IN ("%MAVEN_PROJECTBASEDIR%\.mvn\wrapper\maven-wrapper.properties") DO (
    IF "%%A"=="wrapperUrl" SET WRAPPER_URL=%%B
)

@REM Extension to allow automatically downloading the maven-wrapper.jar from Maven-central
@REM This allows using the maven wrapper in projects that prohibit checking in binary data.
if exist %WRAPPER_JAR% (
    if "%MVNW_VERBOSE%" == "true" (
        echo Found %WRAPPER_JAR%
    )
) else (
    if not "%MVNW_REPOURL%" == "" (
        SET WRAPPER_URL="%MVNW_REPOURL%/org/apache/maven/wrapper/maven-wrapper/3.2.0/maven-wrapper-3.2.0.jar"
    )
    if "%MVNW_VERBOSE%" == "true" (
        echo Couldn't find %WRAPPER_JAR%, downloading it ...
        echo Downloading from: %WRAPPER_URL%
    )

    powershell -Command "&{"^
		"$webclient = new-object System.Net.WebClient;"^
		"if (-not ([string]::IsNullOrEmpty('%MVNW_USERNAME%') -and [string]::IsNullOrEmpty('%MVNW_PASSWORD%'))) {"^
		"$webclient.Credentials = new-object System.Net.NetworkCredential('%MVNW_USERNAME%', '%MVNW_PASSWORD%');"^
		"}"^
		"[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12; $webclient.DownloadFile('%WRAPPER_URL%', '%WRAPPER_JAR%')"^
		"}"
    if "%MVNW_VERBOSE%" == "true" (
        echo Finished downloading %WRAPPER_JAR%
    )
)
@REM End of extension

@REM If specified, validate the SHA-256 sum of the Maven wrapper jar file
SET WRAPPER_SHA_256_SUM=""
FOR /F "usebackq tokens=1,2 delims==" %%A IN ("%MAVEN_PROJECTBASEDIR%\.mvn\wrapper\maven-wrapper.properties") DO (
    IF "%%A"=="wrapperSha256Sum" SET WRAPPER_SHA_256_SUM=%%B
)
IF NOT %WRAPPER_SHA_256_SUM%=="" (
    powershell -Command "&{"^
       "$hash = (Get-FileHash \"%WRAPPER_JAR%\" -Algorithm SHA256).Hash.ToLower();"^
       "If('%WRAPPER_SHA_256_SUM%' -ne $hash){"^
       "  Write-Output 'Error: Failed to validate Maven wrapper SHA-256, your Maven wrapper might be compromised.';"^
       "  Write-Output 'Investigate or delete %WRAPPER_JAR% to attempt a clean download.';"^
       "  Write-Output 'If you updated your Maven version, you need to update the specified wrapperSha256Sum property.';"^
       "  exit 1;"^
       "}"^
       "}"
    if ERRORLEVEL 1 goto error
)

@REM Provide a "standardized" way to retrieve the CLI args that will
@REM work with both Windows and non-Windows executions.
set MAVEN_CMD_LINE_ARGS=%*

%MAVEN_JAVA_EXE% ^
  %JVM_CONFIG_MAVEN_PROPS% ^
  %MAVEN_OPTS% ^
  %MAVEN_DEBUG_OPTS% ^
  -classpath %WRAPPER_JAR% ^
  "-Dmaven.multiModuleProjectDirectory=%MAVEN_PROJECTBASEDIR%" ^
  %WRAPPER_LAUNCHER% %MAVEN_CONFIG% %*
if ERRORLEVEL 1 goto error
goto end

:error
set ERROR_CODE=1

:end
@endlocal & set ERROR_CODE=%ERROR_CODE%

if not "%MAVEN_SKIP_RC%"=="" goto skipRcPost
@REM check for post script, once with legacy .bat ending and once with .cmd ending
if exist "%USERPROFILE%\mavenrc_post.bat" call "%USERPROFILE%\mavenrc_post.bat"
if exist "%USERPROFILE%\mavenrc_post.cmd" call "%USERPROFILE%\mavenrc_post.cmd"
:skipRcPost

@REM pause the script if MAVEN_BATCH_PAUSE is set to 'on'
if "%MAVEN_BATCH_PAUSE%"=="on" pause

if "%MAVEN_TERMINATE_CMD%"=="on" exit %ERROR_CODE%

cmd /C exit /B %ERROR_CODE%
 196 changes: 196 additions & 0 deletions196  
pom.xml
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,196 @@
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>3.1.5</version>
		<relativePath />
	</parent>
	<groupId>com.hcsc</groupId>
	<artifactId>env-uplift-service</artifactId>
	<version>0.0.1-SNAPSHOT</version>
	<name>env-uplift-service</name>
	<description>env-uplift-service</description>
	<properties>
		<java.version>17</java.version>
		<spring-cloud.version>2022.0.4</spring-cloud.version>
		<frontend-maven.version>1.8.0</frontend-maven.version>
		<jarsigner.skip>true</jarsigner.skip>
	</properties>
	<distributionManagement>
		<repository>
			<id>releases</id>
			<name>HCSC releases</name>
			<url>http://nexus.fyiblue.com/repository/releases</url>
		</repository>
		<snapshotRepository>
			<id>snapshots</id>
			<name>HCSC snapshots</name>
			<url>http://nexus.fyiblue.com/repository/snapshots</url>
		</snapshotRepository>
	</distributionManagement>
	<pluginRepositories>
		<pluginRepository>
			<id>hcsc-nexus</id>
			<name>HCSC Nexus Repository</name>
			<url>http://nexus.fyiblue.com/content/groups/public</url>
			<layout>default</layout>
			<releases>
				<updatePolicy>daily</updatePolicy>
				<checksumPolicy>warn</checksumPolicy>
			</releases>
			<snapshots>
				<enabled>true</enabled>
				<updatePolicy>daily</updatePolicy>
				<checksumPolicy>warn</checksumPolicy>
			</snapshots>
		</pluginRepository>
	</pluginRepositories>
	<build>
		<plugins>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-jarsigner-plugin</artifactId>
				<version>3.0.0</version>
				<executions>
					<execution>
						<id>sign</id>
						<phase>verify</phase>
						<goals>
							<goal>sign</goal>
						</goals>
					</execution>
					<execution>
						<id>verify</id>
						<phase>verify</phase>
						<goals>
							<goal>verify</goal>
						</goals>
					</execution>
				</executions>
				<configuration>
					<alias>${env.CERTIFICATE_LABEL}</alias>
					<tsa>http://timestamp.hcsc.net/timestamp</tsa>
					<storetype>PKCS11</storetype>
					<storepass>placeholder</storepass>
					<providerClass>sun.security.pkcs11.SunPKCS11</providerClass>
					<providerArg>${env.WORKSPACE}/venafi.conf</providerArg>
					<errorWhenNotSigned>true</errorWhenNotSigned>
					<excludeClassifiers>
						<excludeClassifier>tests</excludeClassifier>
						<excludeClassifier>javadocs</excludeClassifier>
						<excludeClassifier>sources</excludeClassifier>
					</excludeClassifiers>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.springframework.boot</groupId>
				<artifactId>spring-boot-maven-plugin</artifactId>
				<configuration>
					<image>
						<builder>paketobuildpacks/builder-jammy-base:latest</builder>
					</image>
				</configuration>
			</plugin>
		</plugins>
	</build>
	<repositories>
		<repository>
			<id>hcsc-nexus</id>
			<name>HCSC Nexus Repository</name>
			<url>https://nexus.fyiblue.com/content/groups/public</url>
			<layout>default</layout>
			<releases>
				<updatePolicy>daily</updatePolicy>
				<checksumPolicy>warn</checksumPolicy>
			</releases>
			<snapshots>
				<enabled>true</enabled>
				<updatePolicy>daily</updatePolicy>
				<checksumPolicy>warn</checksumPolicy>
			</snapshots>
		</repository>
		<repository>
			<id>hcsc-nexus-licensed</id>
			<name>HCSC Nexus Repository</name>
			<url>https://nexus.fyiblue.com/repository/licensed</url>
			<layout>default</layout>
			<releases>
				<updatePolicy>daily</updatePolicy>
				<checksumPolicy>warn</checksumPolicy>
			</releases>
			<snapshots>
				<enabled>true</enabled>
				<updatePolicy>daily</updatePolicy>
				<checksumPolicy>warn</checksumPolicy>
			</snapshots>
		</repository>
		<repository>
			<id>thirdparty</id>
			<name>HCSC Nexus Repository</name>
			<url>https://nexus.fyiblue.com/repository/thirdparty</url>
			<layout>default</layout>
			<releases>
				<updatePolicy>daily</updatePolicy>
				<checksumPolicy>warn</checksumPolicy>
			</releases>
			<snapshots>
				<updatePolicy>daily</updatePolicy>
				<checksumPolicy>warn</checksumPolicy>
			</snapshots>
		</repository>
	</repositories>
	<!-- Nexus plugin repository declaration,specifies a remote location of
        where Maven can find new plugins -->
	<dependencies>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
		</dependency>
		<!--<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-data-jpa</artifactId>
		</dependency>-->
		<dependency>
			<groupId>org.springdoc</groupId>
			<artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
			<version>2.3.0</version>
		</dependency>
		<!--<dependency>
			<groupId>com.ibm.db2.jcc</groupId>
			<artifactId>db2jcc4</artifactId>
			<version>10.1</version>
		</dependency>
		<dependency>
			<groupId>com.ibm.db2</groupId>
			<artifactId>db2jcc_license_cu</artifactId>
			<version>10.1</version>
		</dependency>
		<dependency>
			<groupId>com.ibm.db2</groupId>
			<artifactId>db2jcc_license_cisuz</artifactId>
			<version>10.1</version>
		</dependency>-->
		<dependency>
			<groupId>org.jsoup</groupId>
			<artifactId>jsoup</artifactId>
			<version>1.14.3</version>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-validation</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-security</artifactId>
		</dependency>
	</dependencies>
</project>
 15 changes: 15 additions & 0 deletions15  
src/main/java/com/hcsc/envUplift/EnvUpliftServiceApplication.java
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,15 @@
package com.hcsc.envUplift;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.ComponentScan;

@SpringBootApplication
@ComponentScan(value = { "com.hcsc.claim.framework.security" })
public class EnvUpliftServiceApplication {

  public static void main(String[] args) {
    SpringApplication.run(EnvUpliftServiceApplication.class, args);
  }

}
 18 changes: 18 additions & 0 deletions18  
src/main/java/com/hcsc/envUplift/config/RestClientConfig.java
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,18 @@
package com.hcsc.envUplift.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.client.HttpComponentsClientHttpRequestFactory;
import org.springframework.web.client.RestTemplate;

@Configuration
public class RestClientConfig {

  @Bean
  public RestTemplate restTemplate() {
    HttpComponentsClientHttpRequestFactory httpComponentsClientHttpRequestFactory = new HttpComponentsClientHttpRequestFactory();
    return new RestTemplate(httpComponentsClientHttpRequestFactory);

  }

}
 5 changes: 5 additions & 0 deletions5  
src/main/java/com/hcsc/envUplift/config/SwaggerConfig.java
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,5 @@
package com.hcsc.envUplift.config;

public class SwaggerConfig {

}
 37 changes: 37 additions & 0 deletions37  
src/main/java/com/hcsc/envUplift/controller/EnvUpliftController.java
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,37 @@
package com.hcsc.envUplift.controller;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.autoconfigure.EnableAutoConfiguration;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.hcsc.envUplift.service.EnvUpliftService;

@RestController
@EnableAutoConfiguration
@CrossOrigin
@RequestMapping("/api/v1")
public class EnvUpliftController {

  private static final Logger LOG = LoggerFactory.getLogger(EnvUpliftController.class);

  @Autowired
  private EnvUpliftService envUpliftService;

  /**
   * Test endpoint to validate the service is working. To be removed 
   * 
   * @return String
   */
  @GetMapping(value = "/hello")
  public ResponseEntity<String> testEndpoint() {
    return new ResponseEntity<>("Spring Boot application running successfully", HttpStatus.OK);
  }

}
 69 changes: 69 additions & 0 deletions69  
src/main/java/com/hcsc/envUplift/controller/SSOController.java
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,69 @@
package com.hcsc.envUplift.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.util.WebUtils;

import com.hcsc.envUplift.dto.SecurityToken;
import com.hcsc.envUplift.service.SSOService;

import io.swagger.v3.oas.annotations.Operation;
import jakarta.servlet.http.Cookie;
import jakarta.servlet.http.HttpServletRequest;

@RestController
@CrossOrigin
@RequestMapping("/envUplift-api/v1")
public class SSOController {

  @Value("${forgerock.cookie.name}")
  private String frCookieName;

  @Autowired
  private SSOService ssoService;

  /**
   * Using the forgerock cookie return a JWT token
   * 
   * @param request
   * @return
   */
  @Operation(summary = "Get a new JWT token using FRSession cookie", tags = { "Security" })
  @GetMapping("/getJwt")
  @CrossOrigin(originPatterns = { "${app.api.settings.cross.origin.urls.fyiblue}",
      "${app.api.settings.cross.origin.urls.hcsctest}" }, allowCredentials = "true")
    public ResponseEntity<SecurityToken> getSTSToken(HttpServletRequest request) {

      SecurityToken response = null;
      HttpHeaders headers = buildHeader();
      Cookie frCookie = WebUtils.getCookie(request, frCookieName);

      if (frCookie != null) {
        response = ssoService.getSTSToken(frCookie.getValue());
       /** Removed the refresh token for security purpose **/
        response.setRefreshToken(null);
        return new ResponseEntity<>(response, headers, HttpStatus.OK);
      } else {
        return new ResponseEntity<>(headers, HttpStatus.BAD_REQUEST);
      }

    }

  private HttpHeaders buildHeader() {
    StringBuilder allowedHeaders = new StringBuilder(100);
    allowedHeaders.append("X-Requested-With,Content-Type, Accept, Origin, Content-Type");

    HttpHeaders headers = new HttpHeaders();
    headers.add("Access-Control-Allow-Methods", "GET, OPTIONS");
    headers.add("Access-Control-Allow-Headers", allowedHeaders.toString());
    return headers;
  }

}
 31 changes: 31 additions & 0 deletions31  
src/main/java/com/hcsc/envUplift/dto/FRSession.java
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,31 @@
package com.hcsc.envUplift.dto;

import java.io.Serializable;

public class FRSession implements Serializable {
  private static final long serialVersionUID = 1L;

  private String tokenId;
  private String[] roleFilters;

  public FRSession(String tokenId, String[] permFilters) {
    this.tokenId = tokenId;
    this.roleFilters = permFilters;
  }

  public String getTokenId() {
    return tokenId;
  }

  public void setTokenId(String tokenId) {
    this.tokenId = tokenId;
  }

  public String[] getRoleFilters() {
    return roleFilters;
  }

  public void setRoleFilters(String[] roleFilters) {
    this.roleFilters = roleFilters;
  }
}
 92 changes: 92 additions & 0 deletions92  
src/main/java/com/hcsc/envUplift/dto/SecurityToken.java
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,92 @@
package com.hcsc.envUplift.dto;

import com.fasterxml.jackson.annotation.JsonInclude;
import com.fasterxml.jackson.annotation.JsonProperty;

@JsonInclude(JsonInclude.Include.NON_NULL)
public class SecurityToken {
  private String username;

  @JsonProperty("access_token")
  private String accessToken;

  @JsonProperty("token_type")
  private String tokenType;

  @JsonProperty("expires_in")
  private String expiresTn;

  @JsonProperty("refresh_token")
  private String refreshToken;

  private String scope;

  @JsonProperty("jwt_token")
  private String jwtToken;

  private String resultMessage;

  public String getUsername() {
    return username;
  }

  public void setUsername(String username) {
    this.username = username;
  }

  public String getAccessToken() {
    return accessToken;
  }

  public void setAccessToken(String accessToken) {
    this.accessToken = accessToken;
  }

  public String getTokenType() {
    return tokenType;
  }

  public void setTokenType(String tokenType) {
    this.tokenType = tokenType;
  }

  public String getExpiresTn() {
    return expiresTn;
  }

  public void setExpiresTn(String expiresTn) {
    this.expiresTn = expiresTn;
  }

  public String getRefreshToken() {
    return refreshToken;
  }

  public void setRefreshToken(String refreshToken) {
    this.refreshToken = refreshToken;
  }

  public String getScope() {
    return scope;
  }

  public void setScope(String scope) {
    this.scope = scope;
  }

  public String getJwtToken() {
    return jwtToken;
  }

  public void setJwtToken(String jwtToken) {
    this.jwtToken = jwtToken;
  }

  public String getResultMessage() {
    return resultMessage;
  }

  public void setResultMessage(String resultMessage) {
    this.resultMessage = resultMessage;
  }
}
 5 changes: 5 additions & 0 deletions5  
src/main/java/com/hcsc/envUplift/service/EnvUpliftService.java
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,5 @@
package com.hcsc.envUplift.service;

public interface EnvUpliftService {

}
 12 changes: 12 additions & 0 deletions12  
src/main/java/com/hcsc/envUplift/service/SSOService.java
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,12 @@
package com.hcsc.envUplift.service;

import org.springframework.stereotype.Service;
import org.springframework.util.MultiValueMap;

import com.hcsc.envUplift.dto.SecurityToken;
@Service
public interface SSOService {
  public SecurityToken getSTSToken(String forgerockCookie);

  public MultiValueMap<String, String> generateRequestHeaders();
}
 10 changes: 10 additions & 0 deletions10  
src/main/java/com/hcsc/envUplift/service/impl/EnvUpliftServiceImpl.java
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,10 @@
package com.hcsc.envUplift.service.impl;

import org.springframework.stereotype.Service;

import com.hcsc.envUplift.service.EnvUpliftService;

@Service
public class EnvUpliftServiceImpl implements EnvUpliftService {

}
 74 changes: 74 additions & 0 deletions74  
src/main/java/com/hcsc/envUplift/service/impl/SSOServiceImpl.java
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,74 @@
package com.hcsc.envUplift.service.impl;
import org.springframework.security.authentication.AuthenticationServiceException;
import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.HttpEntity;
import org.springframework.http.MediaType;
import org.springframework.stereotype.Service;
import org.springframework.util.LinkedMultiValueMap;
import org.springframework.util.MultiValueMap;
import org.springframework.web.client.RestClientException;
import org.springframework.web.client.RestTemplate;

import com.hcsc.envUplift.dto.FRSession;
import com.hcsc.envUplift.dto.SecurityToken;
import com.hcsc.envUplift.service.SSOService;
import com.hcsc.envUplift.utilities.Constants;

@Service
public class SSOServiceImpl implements SSOService {

  @Value("${forgerock.jwt.frsession.url}")
  private String jwtFrsessionURL;

  @Value("${auth.ldap.clientID}")
  private String clientId;

  @Value("${auth.ldap.clientSecret}")
  private String clientSecret;

  @Value("${forgerock.sso.scope}")
  private String scope;

  @Value("#{'${forgerock.sso.rolefilters}'.split(',')}")
  private String[] rolefilters;

    @Autowired
    private RestTemplate restTemplate;


    public SecurityToken getSTSToken(String forgerockCookie) {
      MultiValueMap<String, String> requestHeaders = generateRequestHeaders();
      HttpEntity<FRSession> httpEntityRequest = new HttpEntity<>(new FRSession(forgerockCookie, rolefilters), requestHeaders);

      try {
        SecurityToken response = restTemplate.postForObject(jwtFrsessionURL, httpEntityRequest, SecurityToken.class);
        response.setResultMessage("Success");
        return response;
      } catch (RestClientException e) {
        throw new AuthenticationServiceException("Request for access token failed.", e);
      }
    }

  /**
   * Generates the headers to be used for making STS calls.
   *
   * @return
   */
  public MultiValueMap<String, String> generateRequestHeaders() {

    if (StringUtils.isEmpty(clientId) || StringUtils.isEmpty(clientSecret)) {
      throw new IllegalArgumentException("Client ID or Client Secret not found");
    }

    MultiValueMap<String, String> headers = new LinkedMultiValueMap<>();
    headers.add(Constants.CONTENT_TYPE, MediaType.APPLICATION_JSON.toString());
    headers.add(Constants.CLIENT_ID, clientId);
    headers.add(Constants.CLIENT_SECRET, clientSecret);
    headers.add(Constants.SCOPE_KEY, scope);

    return headers;
  }

}
 9 changes: 9 additions & 0 deletions9  
src/main/java/com/hcsc/envUplift/utilities/Constants.java
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,9 @@
package com.hcsc.envUplift.utilities;

public class Constants {
  public static final String CLIENT_ID = "ClientID";
  public static final String CLIENT_SECRET = "ClientSecret";
  public static final String CONTENT_TYPE = "Content-Type";
  public static final String SCOPE_KEY = "scope";

}
 66 changes: 66 additions & 0 deletions66  
src/main/resources/application.properties
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,66 @@
server.port=9010

##########################################
# Common Database properties
##########################################
spring.datasource.driverClassName=com.ibm.db2.jcc.DB2Driver
spring.jpa.database-platform=org.hibernate.dialect.DB2Dialect
spring.jpa.hibernate.ddl-auto=none
hibernate.show_sql=false
hibernate.format_sql=false

datasource.host=ZOSKSYS.HCSCINT.NET
datasource.port=2032
datasource.name=DC0C


##########################################
# DB properties
##########################################
#datasource.member-ods.schema=
#member-ods.datasource.url=
#member-ods.datasource.username=
#member-ods.datasource.password=



##########################################
# Authentication/Authorization properties
##########################################
#auth.paths.process=/btm-api/v1/**,/btm-api/v2/**
#auth.paths.skip=/swagger-ui.html,/swagger-ui/**,/v3/api-docs/**,/btm-api/v1/getJwt

auth.ldap.productName=Pivotal Cloud Foundry
auth.ldap.jwt.claimKeyRoles=hcsc_private_claims
auth.ldap.sts.jwt.url.base=https://t-sso-sg-uat-svc.test.hcscint.net
auth.ldap.sts.jwt.url.access=/sts/v5/jwt_token_internal
forgerock.token.enable=true
auth.ldap.scope=openid profile permissions
access.token.scheduled.refresh.schedule.cronExpression=0 1/1 * * * *
access.token.scheduled.refresh.time.interval=2
auth.ldap.clientID=ee9bafab565c479b99073c6da7e36e62
auth.ldap.clientSecret=CcEfB8E84B62440ABDBc829a9a41e933

auth.ig.stv.enabled=false
auth.ig.stv.url=https://t-stv-ig-uat-svc.test.hcscint.net/v3/sec-token-verify
auth.ig.jwks.url=https://t-stv-ig-uat-svc.test.hcscint.net/v1/jwks
forgerock.jwt.frsession.url=https://t-sso-sg-uat-svc.test.hcscint.net/sts/v5/frsession_jwt?compact=true
forgerock.sso.rolefilters=BTM

server.max-http-header-size=32KB

http.cors.allowedOrigins=https://bt-ui-uit2.cfaa.azr.hcsctest.net,https://bt-ui-uit2.test.fyiblue.com,https://bt-ui-uat2.cfaa.azr.hcsctest.net,https://bt-ui-uat2.test.fyiblue.com,http://localhost:4200

enable.payload-standardization=false
enable.payload-standardization-outgoing-response=false

forgerock.cookie.name=tiauthcookie
forgerock.sso.scope=oob profile permissions roles


##########################################
# Allowed CORS Origin URL Array list
##########################################
app.api.settings.cross.origin.urls.fyiblue=https://*.fyiblue.com
app.api.settings.cross.origin.urls.hcsctest=https://*.hcsc*.net

 13 changes: 13 additions & 0 deletions13  
src/test/java/com/hcsc/envUplift/EnvUpliftServiceApplicationTests.java
Marking files as viewed can help keep track of your progress, but will not affect your submitted reviewViewed
Comment on this file
@@ -0,0 +1,13 @@
package com.hcsc.envUplift;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class EnvUpliftServiceApplicationTests {

	@Test
	void contextLoads() {
	}

}
